# 退款、退货 概要设计
退款、退货订单操作的前提是订单支付方式都为:在线支付(押付宝、微信、支付宝支付)；订单删除功能不在设计稿中。

订单状态需要添加六个状态分别为：

- 1.退款中
- 2.已退款(退款成功)
- 3.退款失败
- 4.退货中
- 5.退货成功
- 6.退货失败

退款流程图：
![image](https://github.com/zhangyq1011/images-folder/blob/master/%E7%94%A8%E6%88%B7%E9%80%80%E6%AC%BE%E5%89%8D%E6%B5%81%E7%A8%8B.png)

## 1.买家填写退款单据(mall_order_refund)信息(前提商品订单状态为：已付款)
字段信息有：

- 唯一id
- 买家id(account_id)
- 卖家id(商户id )
- 退款单号(refund_code)  TyyMMdd17777777(T 开头 年两位  月两位  日两位 1 一位  7位随机数字)
- 退款商品订单号(order_id)
- 退款原因(refund_reason) 参见 最后附录 退款原因列表
- 描述说明(refund_desc) 1024个汉字
- 上传图片1 
- 上传图片2
- 上传图片3
- 备用上传图片4
- 备用上传图片4
- 联系人 系统读取订单收货地址 收货人
- 联系电话 系统 读取订单收货人联系电话
- 退款方式 用户提交完订单后自动根据订单支付方式确定 退款方式
- 退款金额 根据用户勾选退款 订单商品金额
- 最终退款金额  可能商家 修改退款金额该值比 “退款金额”有可能大 或者小 
- 退款单状态：   根据状态去区分是第几次提交的退款单据 参见 1.1 
- 退款状态变更描述 ：不同退款单 状态不同的 描述；如：退款失败->退款失败原因等等
- 退款申请时间 系统自动生成
- 标记删除Del_falg   0 未删除  1  删除
- 删除时间
- 审核人   审核人怎么来 还没有确定 ？？？？
- 审核意见 1024个汉字最多
- 审核时间 
- 退款方式：根据退款商品订单类型分为：自动退款和手动退款
- 退款描述：手动退款描述、自动退款描述


### 1.1 退款单据状态有
每一次 订单退款单状态的变更是否需要短信、邮件、站内信、APP推送消息等消息提醒可以考虑。退款单据 最多有两次审核、拘审的机会因此会出现以下退款单据状态：

- 第一次提交申请(待审核0)  需要一个调度任务 参考 1.2 
- 第一次审核通过 1  ->要更新退款单据 商品订单状态为 ：退款中
- 第一次审核不通过(第一次 拘审2 )  ->可以再次提交退款申请单据(填写类似第一次填写的内容)
- 第二次提交申请(待审核01) 此时会产生雷同第一次申请的记录 但是 退款单据号 和第一次的单据号保持一致。 需要一个调度任务 参考 1.3 
- 第二次审核通过 11  ->要更新退款单据 商品订单状态为 ：退款中
- 第二次审核不通过(第二次 拘审 21)

### 1.2 处理第一次提交申请退款的调度任务
买家第一次提交申请退款后 需要设置一个 时间点值这个时间点可以是：1天 24小时 也可以是 1小时等等 ；在这个时间点内如果卖家不进行审核通过或者拘审操作默认就变更为：审核通过状态，订单状态变更为：退款中

### 1.3 处理第二次提交申请退款的调度任务
买家第二次提交申请退款后 需要设置一个 时间点值这个时间点可以是：1天 24小时 也可以是 1小时等等 ；在这个时间点内如果卖家不进行审核通过或者拘审操作默认就变更为：审核通过状态，订单状态变更为：退款中


### 1.4 退款中的订单需要一个调度任务如果长时间状态不变更需要做什么操作
退款 申请提交完毕后长时间退款中需要做什么处理还没有拿到需要确定的 处理方式。    

## 2.根据商品订单不同支付方式退款详细流程操作
退款流程图如下

![image](https://github.com/zhangyq1011/images-folder/blob/master/%E5%95%86%E6%88%B7%E9%80%80%E6%AC%BE%E6%B5%81%E7%A8%8B%E5%9B%BE.png)


微信、支付宝前期做手动退款、不做接口退款。
押付宝支付退款资金处理：
先回忆原来网站的资金流程
 - 1.华禽网要开一个账户实名认证的账户 作为华禽网所有交易的收款账户
 - 2.华禽网自营需要一个押付宝账户用于 押付宝收到所有华禽网的款项定期结算给华禽网自营商户
 - 3.第三方商家入驻后也需要一个押付宝账户用于   押付宝收到第三方商户在华禽网的款项定期结算使用
 - 4.最终确定的退款流程为:根据买家购买商品订单号资金由华禽网 商户直接退回给买家。

  


